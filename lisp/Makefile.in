# Emacs Makefile for TRAMP
# @configure_input@

# Copyright (C) 1998, 1999, 2000, 2001, 2002, 2003 Free Software Foundation, Inc.

# Author: Kai.Grossjohann@CS.Uni-Dortmund.DE 
#         Michael.Albinus@alcatel.de
# Keywords: comm, processes

# This file is part of GNU Emacs.

# GNU Emacs is free software; you can redistribute it and/or modify
# it under the terms of the GNU General Public License as published by
# the Free Software Foundation; either version 2, or (at your option)
# any later version.

# GNU Emacs is distributed in the hope that it will be useful,
# but WITHOUT ANY WARRANTY; without even the implied warranty of
# MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
# GNU General Public License for more details.

# You should have received a copy of the GNU General Public License
# along with GNU Emacs; see the file COPYING.  If not, write to the
# Free Software Foundation, Inc., 59 Temple Place - Suite 330,
# Boston, MA 02111-1307, USA.

# This Makefile requires GNU make.

EMACS		= @EMACS@
INSTALL		= install -m644
MKDIR		= mkdir -p
RM		= -rm -f

prefix		= @prefix@
datadir		= @datadir@
lispdir		= @lispdir@

CLEAN_FILES	= @TRAMP_CLEAN_FILES@

# trampver.el and tramp.el must be handled first due to dependencies
LISP_FILES	= trampver.el tramp.el tramp-smb.el tramp-util.el \
		  tramp-uu.el tramp-vc.el trampcache.el

# tramp-ftp and tramp-efs are usefull for Emacs resp XEmacs only
ifeq ($(EMACS_INFO), emacs)
  LISP_FILES += tramp-ftp.el
else
  LISP_FILES += tramp-efs.el
endif

EVAL = --eval "(add-to-list 'load-path \".\")" 

ifdef USE_CONTRIB
  EVAL += --eval "(add-to-list 'load-path \"../contrib\")"
endif

ifeq ($(EMACS_INFO), emacs)
  EM = $(EMACS) --no-site-file -batch $(EVAL) -f batch-byte-compile 
else
  EM = $(EMACS) -vanilla -batch $(EVAL) -f batch-byte-compile 
endif

# To be used by maintainer only
FTPDIR		= /home-local/ftp/pub/src/emacs
SLISP		= /app/unido-i06/sun4_56/edit/emacs/20.5/share/emacs/site-lisp

.PHONY: all install clean distclean tramp install-ftp site-lisp

.SUFFIXES: .elc .el

all: $(addsuffix .elc, $(basename $(LISP_FILES)))

%.elc: %.el
	$(EM) $?

install: $(LISP_FILES) $(addsuffix .elc, $(basename $(LISP_FILES)))
	$(MKDIR) $(lispdir)
	$(INSTALL) $? $(lispdir)

clean:
	$(RM) $(CLEAN_FILES)

distclean: clean

# Maintainer targets

tramp: all

install-ftp: all
	$(INSTALL) tramp.el $(FTPDIR)

site-lisp: all
	/usr/ucb/$(INSTALL) tramp.el $(SLISP)
	cd $(SLISP) && emacs-20.5 -batch -f batch-byte-compile tramp.el

xemacs:
	cp $(LISP_FILES) ChangeLog $(XEMACS_TARGET)/lisp
